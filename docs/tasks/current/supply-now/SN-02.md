# SN-02: Client Company Profile — Real Data & Settings

**ID:** SN-02 (previously BE-01.1, related to [SN-01](SN-01.md))
**Status:** :material-progress-clock: In Progress
**Priority:** Medium
**Estimated effort:** 8-12 hours

## Apps Affected

| App | Role | Impact |
|-----|------|--------|
| :material-cellphone: **Supply Now** | Client app — Profile screen | Core — replace mocked Company tab with real data |
| :material-server: **Django Backend** | API endpoints | Minor — endpoints already exist, may need adjustments |

## Description

Replace hardcoded "Acme Corporation" on the Supply Now Profile screen's **Company tab** with real client data from API. Display all companies linked to user via `ClientUserLink` with user's role (Admin/Manager) for each company. Enable Admin editing of company details and self-controlled settings. Show platform block status as read-only. Implement current client switching for multi-company users.

**Key clarification (2026-02-16):** Dynamic tab title — "Company" when user has one company, "Companies (N)" when multiple. Same pattern as Suppliers tab. User's role (Admin/Manager) shown per company.

## Scope

**In scope:**

- Fetch user's clients via `/api/actors/client-user-link/?user={id}` API
- Display list of client companies on Company tab with **dynamic tab title** ("Company" / "Companies (N)")
- Show **user's role** (Admin/Manager) for each company as a badge
- Client card: name, official_name, VAT, address, logo, status
- `ClientSettingsSelfControlled` fields display and editing (Admin only)
- `ClientControlledByPlatform.is_blocked` read-only display
- Role-based access (Admin edit, Manager read-only + "contact admin" hint)
- Current client switcher (multi-client, only shown when > 1 company)
- Order blocking for blocked clients
- Login-time warning for fully-blocked users

**Out of scope:**

- Creating new clients from app
- Deleting clients
- Managing `ClientSupplierLink` (covered by SN-01)
- Supplier-controlled settings
- Client address CRUD (separate task)

## Success Criteria

- [ ] Company tab shows real data from API (no hardcoded values)
- [ ] Tab title: "Company" (1) or "Companies (N)" (multiple)
- [ ] User's role displayed per company (Admin/Manager badge)
- [ ] Client fields: name, official_name, VAT, address, logo
- [ ] `ClientSettingsSelfControlled` visible and editable by Admin
- [ ] `ClientControlledByPlatform.is_blocked` shown read-only with message
- [ ] Admin can edit company details; Manager sees read-only + "contact admin" hint
- [ ] Current client switcher works (multiple clients)
- [ ] Blocked client cannot be set as primary
- [ ] Order creation blocked for blocked clients
- [ ] No regressions on Personal and Suppliers tabs

## Key Risks

| Risk | Severity | Description |
|------|----------|-------------|
| API data gaps | :material-alert-outline: Medium | `client-user-link` API returns only IDs — may need nested client serializer |
| Platform block not exposed | :material-alert-outline: Medium | `ClientControlledByPlatform.is_blocked` not in current API responses |
| Order blocking scope | :material-alert: High | Must be enforced both in UI and API, touches multiple parts of the app |
| No admin test data | :material-alert-outline: Medium | Need seed data with ClientUserLink role=ADMIN |

## Key Files

| Component | File | Notes |
|-----------|------|-------|
| Mock data (to replace) | `profile_screen.dart:674-724` | `_buildCompanyTab()` with "Acme Corporation" |
| Tab structure | `profile_screen.dart:485-504` | TabBar with 3 tabs |
| Suppliers tab pattern | `profile_screen.dart:501-503` | Dynamic count — reuse for Company |
| ClientUserLink model | `shared_core/models/client_user_link_model.dart` | Freezed: id, user, client, role |
| Client API service | `shared_core/api/clients_api_service.dart` | getClient(), getClientSettings(), patchClientSettings() |
| ClientUserLink API | `shared_core/api/client_user_links_api_service.dart` | CRUD via `/api/actors/client-user-link/` |
| Django Client model | `actors/models.py:118-173` | name, official_name, vat_number, logo |
| Django ClientUserLink | `actors/models.py:341-372` | role: admin/manager |
| Django settings models | `preferences/models.py:87-266` | ClientControlledByPlatform, ClientSettingsSelfControlled |

---

!!! tip "Full task details"
    Full working file: `django_project/docs/_ai_context/CURRENT_TASK_Client_Profile_Real_Data.md` — benchmarks, research, components, implementation phases
