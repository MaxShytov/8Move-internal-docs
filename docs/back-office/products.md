# Продукты (Products)

Модуль продуктов — это полный каталог с поддержкой категорий, множественных единиц измерения, гибкого ценообразования (базовые, категорийные, индивидуальные цены), штрихкодов и QR-кодов.

---

## Список продуктов

### Доступ

Боковая панель → **Products** или Дашборд → **View All Products**

### Структура экрана

Экран разделён на две части:

- **Левая панель** (300px) — дерево категорий
- **Основная область** — панель поиска/фильтров + таблица продуктов + пагинация

---

### Дерево категорий {#category-tree}

Боковая панель категорий позволяет быстро фильтровать продукты:

| Элемент | Описание |
|---------|----------|
| **All Categories** | Показать все продукты (без фильтра по категории) |
| **No category** | Только продукты без категории (с бейджем количества) |
| **Категории** | Иерархический список. Категории с подкатегориями можно раскрыть/свернуть |

Каждая категория показывает:

- Изображение категории (или иконку по умолчанию)
- Название
- Количество продуктов (бейдж)
- Меню :material-dots-vertical: с действиями: **Edit category** / **Delete category**

Кнопка **+ Add Category** — создание новой категории.

!!! warning "Удаление категории"
    При удалении категории появляется диалог подтверждения. Продукты из удалённой категории останутся, но будут без категории.

---

### Панель поиска и инструментов

| Элемент | Описание |
|---------|----------|
| :material-magnify: **Поиск** | Текстовый поиск по названию и артикулу (с задержкой 500мс) |
| :material-account-search: **Клиент** | Выбор клиента для отображения клиентских цен (см. [Клиентские цены](#client-price-column)) |
| :material-sort: **Сортировка** | Сортировка по: Name, Article, Category |
| :material-refresh: **Обновить** | Перезагрузить данные |
| :material-tune: **Фильтры** | Открыть панель фильтров (с бейджем количества активных фильтров) |

#### Активные фильтры

Выбранные фильтры отображаются как чипы под строкой поиска. Каждый чип можно удалить нажатием :material-close:.

---

### Фильтры {#filters}

Панель фильтров открывается снизу экрана и содержит:

| Раздел | Варианты |
|--------|----------|
| **Status** | All / Active products / Inactive products |
| **Images** | All / Has image / No image |
| **Base Price** | All / Has base price / No base price |
| **Base Unit** | All / Has base unit / No base unit |
| **Price Category** | All / No price category / (список категорий ценообразования) |

Нажмите **Apply** для применения фильтров.

---

### Таблица продуктов

| Колонка | Описание | Примечание |
|---------|----------|------------|
| **Name** (закреплена) | Миниатюра продукта (44×44px) + название + артикул + индикатор статуса (зелёная/красная точка) + бейдж категории | Колонка закреплена — остаётся видимой при горизонтальной прокрутке |
| **Unit / Tax** | Единица измерения (аббревиатура + вес) + ставка НДС + предупреждения | Предупреждения см. ниже |
| **Client Price** | Цена для выбранного клиента (фиолетовый цвет) | Только когда выбран клиент |
| **Base Price** | Базовая цена + валюта | С иконкой :material-pencil: для инлайн-редактирования |
| **Цены категорий** | По одной колонке на каждую категорию ценообразования | С иконкой :material-pencil: для инлайн-редактирования |

Нажатие на строку открывает форму редактирования продукта.

#### Предупреждения единиц измерения

В колонке «Unit / Tax» могут отображаться предупреждения:

| Предупреждение | Уровень | Описание |
|---------------|---------|----------|
| **No units** | :material-alert-circle:{ .red } Критичное | У продукта нет единиц измерения |
| **No orderable units** | :material-alert-circle:{ .red } Критичное | Ни одна единица не отмечена как «orderable» |
| **Base unit not orderable** | :material-alert:{ .orange } Важное | Базовая единица не доступна для заказа |
| **Has min order qty** | :material-alert:{ .orange } Важное | Есть ограничение минимального количества |

При наведении на предупреждение показывается подсказка с деталями.

---

### Колонка клиентских цен {#client-price-column}

Для отображения цен конкретного клиента:

1. Нажмите :material-account-search: в панели инструментов
2. Выберите клиента из диалога
3. Появится дополнительная колонка **Client Price**

Колонка показывает:

- **Индивидуальную цену** (если установлена) — фиолетовым цветом
- **Зачёркнутую обычную цену** (если есть индивидуальная)
- **«No price for client»** — если цена не установлена (курсивом, серым)
- Иконка :material-pencil: для быстрого редактирования цены

Для сброса фильтра клиента нажмите :material-close: на чипе клиента.

---

### Инлайн-редактирование цен {#inline-price-edit}

Нажмите иконку :material-pencil: рядом с любой ценой в таблице для её редактирования без перехода к форме продукта.

Откроется диалог с полями:

- **Price** — цена (обязательное поле)
- **Unit** — единица измерения (выбор из единиц продукта)

Для клиентских цен также доступна кнопка **Delete** для удаления индивидуальной цены.

---

## Форма продукта {#product-form}

### Создание

Нажмите **+ Add Product** в списке продуктов.

### Редактирование

Нажмите на строку продукта в таблице.

---

### Раздел: Основная информация {#basic-info}

| Поле | Описание | Обязательное |
|------|----------|:------------:|
| **Product Status** | Переключатель Active/Inactive | :white_check_mark: |
| **Name** | Название продукта | :white_check_mark: |
| **Article** | Артикул / SKU | :white_check_mark: |
| **Description** | Описание (многострочное) | — |
| **Category** | Выбор категории из выпадающего списка (иерархический, с отступами для подкатегорий) | — |
| **Tax Rate** | Ставка НДС (выбор из списка, отображается как «Название (ставка%)») | :white_check_mark: |

#### Статус продукта

- **Active** — продукт виден и доступен для заказа
- **Inactive** — продукт скрыт и недоступен для заказа

---

### Раздел: Изображение продукта {#images}

#### При создании

Одно поле для загрузки основного изображения через **Gallery** или **Camera**.

#### При редактировании

Полноценное управление изображениями:

- **Сетка** миниатюр (3–4 в ряду в зависимости от ширины экрана)
- **Primary image** — основное изображение отмечено звездой :material-star:
- **Добавление** — кнопка «Add Image» → выбор из Gallery / Camera
- **Назначение основным** — нажмите :material-star-outline: на изображении
- **Удаление** — нажмите :material-close: (с подтверждением)
- **Прогресс загрузки** — отображается полоса прогресса при загрузке

Основное изображение — это то, что отображается в списке продуктов и в заказах.

---

### Раздел: Единицы измерения {#units}

Таблица единиц измерения продукта:

| Колонка | Описание |
|---------|----------|
| **Unit** | Название + аббревиатура (например, «Kilogram (kg)») |
| **Packaging Level** | Уровень упаковки: Primary / Secondary / Tertiary |
| **Conversion Rate** | Коэффициент пересчёта |
| **Weight (kg)** | Вес единицы |
| **Orderable** | :material-check-circle:{ .green } доступна для заказа или :material-cancel:{ .red } нет |
| **Min Order Qty** | Минимальное количество заказа (если установлено) |
| **Действия** | Редактировать / Удалить |

**Base Unit** — базовая единица выбирается в выпадающем списке над таблицей. Это основная единица, на которую ссылаются все цены и пересчёты.

#### Добавление / редактирование единицы

| Поле | Описание | Обязательное |
|------|----------|:------------:|
| **Unit Classifier** | Тип единицы из справочника (kg, Stk, Karton и т.д.) | :white_check_mark: |
| **Packaging Level** | Primary / Secondary / Tertiary | :white_check_mark: |
| **Conversion Rate** | Коэффициент пересчёта (должен быть > 0) | :white_check_mark: |
| **Weight (kg)** | Вес в килограммах | — |
| **Orderable** | Может ли клиент заказывать в этой единице | По умолчанию включено |
| **Min Order Quantity** | Минимальное количество при заказе | — |

---

### Раздел: Базовая цена {#base-price}

Базовая цена — цена по умолчанию, применяемая ко всем клиентам (если не переопределена категорийной или индивидуальной ценой).

| Поле | Описание | Обязательное |
|------|----------|:------------:|
| **Price** | Значение цены | :white_check_mark: |
| **Unit** | Единица измерения (из единиц продукта) | :white_check_mark: |

!!! info "Валюта"
    Валюта берётся из настроек поставщика и отображается в виде символа перед полем цены.

---

### Раздел: Цены по категориям {#category-prices}

Цены по категориям ценообразования **переопределяют** базовую цену для клиентов, привязанных к определённой категории.

Таблица:

| Колонка | Описание |
|---------|----------|
| **Category** | Название категории ценообразования |
| **Price** | Цена |
| **Unit** | Единица измерения |
| **Действия** | Редактировать / Удалить |

Информационный баннер показывает текущую базовую цену для справки. Если базовая цена не установлена — отображается предупреждение.

#### Добавление / редактирование категорийной цены

| Поле | Описание | Обязательное |
|------|----------|:------------:|
| **Price Category** | Категория ценообразования (при редактировании — только для чтения) | :white_check_mark: |
| **Price** | Цена | :white_check_mark: |
| **Unit** | Единица измерения | :white_check_mark: |

---

### Раздел: Индивидуальные цены {#individual-prices}

Индивидуальные цены — персональные цены для конкретных клиентов. Имеют **наивысший приоритет** и переопределяют как базовую, так и категорийную цену.

Таблица с пагинацией (10 на страницу):

| Колонка | Описание |
|---------|----------|
| **Client** | Имя клиента |
| **Price** | Цена |
| **Unit** | Единица измерения |
| **Действия** | Редактировать / Удалить |

**Фильтр по клиенту** — чип :material-filter: позволяет показать цены только для определённого клиента.

#### Добавление / редактирование индивидуальной цены

| Поле | Описание | Обязательное |
|------|----------|:------------:|
| **Client** | Выбор клиента через диалог (при редактировании — только для чтения) | :white_check_mark: |
| **Price** | Цена | :white_check_mark: |
| **Unit** | Единица измерения (по умолчанию — базовая единица продукта) | :white_check_mark: |

---

### Приоритет ценообразования

```
Индивидуальная цена клиента (наивысший приоритет)
    ↓
Цена категории ценообразования
    ↓
Базовая цена (наинизший приоритет)
```

---

### Раздел: Штрихкоды {#barcodes}

Таблица штрихкодов продукта с пагинацией (10 на страницу):

| Колонка | Описание |
|---------|----------|
| **Barcode** | Значение штрихкода + иконка предпросмотра :material-barcode-scan: |
| **Type** | Тип (EAN-13, QR Code, UPC/EAN-128, Code39) |
| **Unit** | Единица измерения |
| **Действия** | Редактировать / Удалить |

Нажатие на иконку :material-barcode-scan: открывает **предпросмотр штрихкода** — визуальное отображение + значение текстом.

#### Добавление / редактирование штрихкода

| Поле | Описание | Обязательное |
|------|----------|:------------:|
| **Barcode Value** | Значение штрихкода | :white_check_mark: |
| **Barcode Type** | EAN-13 (по умолчанию) / QR Code / UPC/EAN-128 / Code39 | :white_check_mark: |
| **Unit** | Единица измерения | :white_check_mark: |

---

### Раздел: QR-коды {#qr-codes}

Таблица QR-кодов продукта с пагинацией (10 на страницу):

| Колонка | Описание |
|---------|----------|
| **Client** | Имя клиента или «No client — anyone can scan» (универсальный) |
| **QR Value** | Значение QR-кода + иконка предпросмотра :material-qrcode: |
| **Unit** | Единица измерения |
| **Действия** | Редактировать / Удалить |

QR-коды без привязки к клиенту (универсальные) отображаются **первыми** в списке.

**Фильтр по клиенту** — чип :material-filter: для фильтрации по конкретному клиенту.

Нажатие на иконку :material-qrcode: открывает **предпросмотр QR-кода**.

#### Добавление / редактирование QR-кода

| Поле | Описание | Обязательное |
|------|----------|:------------:|
| **QR Value** | Значение QR-кода | :white_check_mark: |
| **Unit** | Единица измерения | :white_check_mark: |
| **Client ID** | ID клиента (необязательно). Если пусто — универсальный QR-код | — |

---

## Управление категориями {#categories}

### Создание категории

1. Нажмите **+ Add Category** в дереве категорий
2. Заполните:
    - **Category Name** (обязательно, минимум 2 символа)
    - **Category Image** (необязательно)
3. Нажмите **Create Category**

### Создание подкатегории

1. В дереве категорий нажмите :material-dots-vertical: → **Edit category** на родительской категории
2. Или используйте выбор родительской категории при создании

### Редактирование категории

Нажмите :material-dots-vertical: → **Edit category** в дереве категорий.

### Удаление категории

Нажмите :material-dots-vertical: → **Delete category**. Подтвердите удаление в диалоге.

---

## FAQ

??? question "Как установить цену для конкретного клиента?"
    Два способа:

    1. **Из списка продуктов**: выберите клиента в панели инструментов → нажмите :material-pencil: в колонке Client Price
    2. **Из формы продукта**: перейдите в раздел «Individual Client Prices» → нажмите **Add Price** → выберите клиента

??? question "Почему продукт не доступен для заказа?"
    Проверьте:

    - Продукт должен быть в статусе **Active**
    - У продукта должна быть хотя бы одна единица с флагом **Orderable**
    - У продукта должна быть установлена цена

??? question "В чём разница между базовой ценой и категорийной?"
    **Базовая цена** — цена по умолчанию для всех клиентов. **Категорийная цена** — специальная цена для группы клиентов, привязанных к определённой категории ценообразования. Категорийная цена имеет приоритет над базовой.

??? question "Что такое 'Frozen' колонка в таблице?"
    Колонка «Name» закреплена (frozen) — она всегда остаётся видимой при горизонтальной прокрутке таблицы. Это удобно, когда у вас много колонок с ценами.
