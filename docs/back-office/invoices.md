# Счета (Invoices)

Модуль счетов позволяет формировать счета на основе выполненных доставок, отслеживать их статус, генерировать PDF и отправлять клиентам по email.

---

## Список счетов

### Доступ

Боковая панель → **Invoices**

### Таблица счетов

| Колонка | Описание | Сортировка |
|---------|----------|:----------:|
| **Invoice Number** | Номер счёта. Иконка :material-lock: если финализирован | :white_check_mark: |
| **Customer** | Имя клиента | — |
| **Period** | Период (дата начала — дата конца) | — |
| **Total** | Сумма + валюта | :white_check_mark: |
| **Issued At** | Дата выставления | :white_check_mark: |
| **Items** | Количество позиций | — |

По умолчанию счета отсортированы по дате выставления (новые первыми).

### Поиск

Текстовое поле для поиска по номеру счёта.

### Пагинация

Постраничная навигация с выбором количества элементов на странице.

---

## Создание счёта {#create}

Нажмите **+ Create Invoice** для перехода к форме создания.

Создание счёта происходит в **3 шага**:

### Шаг 1. Выбор клиента и периода

| Поле | Описание | Обязательное |
|------|----------|:------------:|
| **Supplier** | Текущий поставщик (заполняется автоматически, только для чтения) | — |
| **Customer** | Выбор клиента через диалог поиска | :white_check_mark: |
| **Period Start** | Начало периода (по умолчанию: 30 дней назад) | :white_check_mark: |
| **Period End** | Конец периода (по умолчанию: сегодня) | :white_check_mark: |

После заполнения нажмите **Load Deliveries** — система загрузит все неоплаченные доставки для выбранного клиента за указанный период.

### Шаг 2. Выбор доставок

После загрузки отображается список доставок с чекбоксами:

- По умолчанию **все доставки выбраны**
- Каждая строка содержит: номер заказа, дату доставки, сумму
- Кнопки **Select All** / **Deselect All** для массового выбора

!!! info "Нет доставок?"
    Если список пуст — за выбранный период нет неоплаченных доставок для этого клиента. Попробуйте расширить период.

### Шаг 3. Создание

Отображается сводка:

- **Deliveries Selected** — количество выбранных доставок
- **Total Amount** — общая сумма

Нажмите **Create Invoice**. После создания вы будете перенаправлены на страницу детальной информации о счёте.

---

## Детали счёта {#detail}

Страница детальной информации разделена на две колонки.

### Левая колонка

#### Карточка «Parties» (Стороны)

**Поставщик:**

| Поле | Описание |
|------|----------|
| Название | Имя поставщика |
| Адрес | Адрес поставщика (если указан) |
| ИНН (VAT Number) | Если указан |
| IBAN банка | Если указан |
| Владелец счёта | Если указан |

!!! warning "Предупреждения"
    Если у поставщика не указан адрес или банковский счёт — отображается красное предупреждение. Для исправления нажмите кнопку :material-pencil: рядом с секцией поставщика — откроются [Настройки поставщика](settings.md).

**Клиент:**

| Поле | Описание |
|------|----------|
| Название | Имя клиента |
| Адрес | Если указан |
| Email | Если указан. Если нет — красное предупреждение «No email» |

Кнопка :material-pencil: ведёт в форму редактирования клиента.

#### Карточка «Invoice Items» (Позиции)

Таблица позиций счёта:

| Колонка | Описание |
|---------|----------|
| **Order Number** | Номер заказа |
| **Delivery Date** | Дата доставки |
| **Amount** | Сумма заказа |

### Правая колонка

#### Карточка «Details»

| Поле | Описание |
|------|----------|
| **Status** | «Draft» (черновик) или «Finalized» (финализирован) |
| **Period** | Период счёта |
| **Payment Terms** | Условия оплаты (дней) |

Бейдж в заголовке:

- **Draft** — если счёт не финализирован
- **Email not sent** — если финализирован, но email не отправлен

#### Карточка «Total Amount»

| Поле | Описание |
|------|----------|
| **Subtotal** | Сумма без НДС |
| **VAT** | Сумма НДС |
| **Total** | Итого с НДС (выделено жирным, крупным шрифтом) |

---

## Действия со счётом {#actions}

### Финализация

Кнопка **Finalize Invoice** :material-lock: доступна только для черновиков.

При нажатии открывается диалог:

- Текст подтверждения
- Чекбокс **«Send email to client»** (по умолчанию включён)
- Кнопки: **Cancel** / **Finalize Invoice**

После финализации счёт блокируется для редактирования.

### Генерация PDF

- **Generate PDF** — создать PDF-файл счёта
- **Regenerate PDF** — пересоздать PDF (если уже существует)

После нажатия файл генерируется на сервере. Через несколько секунд страница обновится.

### Просмотр PDF

Кнопка **Open PDF** :material-file-pdf-box: появляется после генерации PDF. Открывает файл в новой вкладке браузера.

### Отправка Email

Кнопка **Send Email** :material-send: доступна только для финализированных счетов.

Перед отправкой появится диалог подтверждения. После успешной отправки отображается зелёный баннер с датой и временем отправки.

---

## FAQ

??? question "Можно ли удалить счёт?"
    Удаление счетов через интерфейс Back Office не предусмотрено. Обратитесь к администратору.

??? question "Почему нет кнопки 'Send Email'?"
    Кнопка отправки email доступна только для **финализированных** счетов. Сначала нажмите «Finalize Invoice».

??? question "Как пересоздать PDF после изменений?"
    Нажмите **Regenerate PDF**. Старый файл будет заменён новым.

??? question "Что делать, если у клиента нет email?"
    Перейдите в редактирование клиента (кнопка :material-pencil: в карточке клиента) и добавьте email-адрес в разделе [контактной информации](clients.md#contact-info).
